# HG changeset patch
# User Wolfgang Rosenauer
# Date 1558442915 -7200
#      Tue May 21 14:48:35 2019 +0200
# Node ID 5ef9114bf8c930773b8c97f84c3d667d8f6f391d
# Parent  73762c64e81c873e2bf5ac4cf61ee21098b9a768
Do not use gconf for proxy settings if not running within Gnome
Index: toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp
===================================================================
RCS file: /cvsroot/mozilla/toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp,v
retrieving revision 1.1

diff -r 73762c64e81c -r 5ef9114bf8c9 toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp
--- a/toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp	Sat Jun 01 03:00:24 2019 +0000
+++ b/toolkit/system/unixproxy/nsUnixSystemProxySettings.cpp	Tue May 21 14:48:35 2019 +0200
@@ -55,11 +55,14 @@
 }
 
 void nsUnixSystemProxySettings::Init() {
-  mGSettings = do_GetService(NS_GSETTINGSSERVICE_CONTRACTID);
-  if (mGSettings) {
-    mGSettings->GetCollectionForSchema(
-        NS_LITERAL_CSTRING("org.gnome.system.proxy"),
-        getter_AddRefs(mProxySettings));
+  const char* sessionType = PR_GetEnv("DESKTOP_SESSION");
+  if (sessionType && !strcmp(sessionType, "gnome")) {
+    mGSettings = do_GetService(NS_GSETTINGSSERVICE_CONTRACTID);
+    if (mGSettings) {
+      mGSettings->GetCollectionForSchema(
+          NS_LITERAL_CSTRING("org.gnome.system.proxy"),
+          getter_AddRefs(mProxySettings));
+    }
   }
 }
 
